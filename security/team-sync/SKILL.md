# team-sync

多人协作文档同步，确保团队成员间的信息传递。

## 触发条件

### 自动触发
- 会话结束时
- 完成重要功能后
- 检测到文档过期（>24h未更新）

### 手动触发
- `/team:sync`
- `/team:handoff`

## 维护的文档

### 1. 团队状态板 `.claude/team/status.md`

```markdown
# 团队状态板

> 最后更新: {timestamp}

## 当前活跃

| 成员 | 任务 | 分支 | 状态 | 开始时间 |
|------|------|------|------|----------|
| @张三 | #task-001 用户登录 | feature/auth | 进行中 | 2024-01-10 |
| @李四 | #task-003 订单模块 | feature/order | 代码审查 | 2024-01-09 |

## 最近完成

| 成员 | 任务 | 完成时间 | PR |
|------|------|----------|-----|
| @王五 | #task-002 支付集成 | 2024-01-10 | #42 |

## 阻塞事项

| 任务 | 阻塞原因 | 需要 | 负责人 |
|------|----------|------|--------|
| #task-004 | 等待 API 文档 | @后端团队 | @张三 |
```

### 2. 交接文档 `.claude/team/handoff.md`

```markdown
# 任务交接记录

## {日期} - {任务名} 交接

### 交接人
- **从**: @张三
- **到**: @李四

### 任务状态
- **完成度**: 70%
- **分支**: feature/auth
- **最后提交**: a1b2c3d

### 已完成
- [x] 数据模型设计
- [x] 登录接口实现
- [x] JWT 生成

### 待完成
- [ ] 刷新 Token 逻辑
- [ ] 登出接口
- [ ] 单元测试

### 注意事项
- `src/auth/token.ts` 中的 SECRET 需要从环境变量读取
- 参考 `docs/auth-flow.md` 了解完整流程

### 相关文件
- `src/auth/*` - 主要代码
- `src/models/user.ts` - 用户模型
- `.claude/sessions/2024-01-10-auth.md` - 开发记录

### 遗留问题
1. Token 过期时间待定，目前是 1 小时
2. 是否需要支持多设备登录？
```

### 3. 决策日志 `.claude/team/decisions.md`

```markdown
# 团队决策日志

## 2024-01-10 - JWT vs Session 认证

**参与者**: @张三, @李四, @王五

**背景**: 需要选择用户认证方案

**选项**:
1. JWT Token - 无状态，适合分布式
2. Session - 有状态，需要 Redis

**决定**: JWT Token

**理由**:
- 后续会部署多实例
- 减少 Redis 依赖
- 移动端更友好

**影响**:
- 需要实现 Token 刷新机制
- 登出需要黑名单机制
```

### 4. 每日站会 `.claude/team/standup/{date}.md`

```markdown
# 站会记录 - 2024-01-10

## @张三
**昨天**: 完成用户登录接口
**今天**: 实现 Token 刷新
**阻塞**: 无

## @李四
**昨天**: 订单模块数据库设计
**今天**: 订单 CRUD 接口
**阻塞**: 等待支付接口文档

## 讨论事项
- Token 过期时间定为 2 小时
- 下周开始前端联调
```

## 执行流程

### 会话结束时自动执行

1. **更新状态板**
   - 标记任务状态变更
   - 更新完成进度
   - 记录阻塞事项

2. **生成交接信息**
   - 如果任务未完成，生成交接文档
   - 记录当前状态和注意事项
   - 列出相关文件

3. **同步决策**
   - 提取会话中的重要决策
   - 记录到决策日志
   - 标注参与者和影响

### 确认检查点

```
📋 团队同步检查

即将更新以下文档：
1. team/status.md - 更新任务状态
2. team/handoff.md - 添加交接记录（如需要）
3. sessions/xxx.md - 保存会话记录

是否确认？(y/n/e)
- y: 确认更新
- n: 跳过
- e: 编辑后更新
```

## 多人协作最佳实践

### 开始工作前

```
/team:status          # 查看团队状态
/workflow:understand  # 加载上下文
```

### 工作中

```
# 遇到重要决策时
/team:decision "选择 TypeORM 而不是 Prisma"

# 遇到阻塞时
/team:block "等待设计稿"
```

### 结束工作时

```
/session:end          # 自动触发 team-sync
# 或手动
/team:handoff @李四   # 指定交接给谁
```
