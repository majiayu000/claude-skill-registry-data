---
name: consultation
description: Claude(スマホ・PC)への相談スキル。実装中に判断が必要になった時、技術選定が必要な時、設計相談が必要な時に使用。
---

# Consultation(Claude相談)

## 📋 実行前チェック(必須)

### このスキルを使うべきか?
- [ ] 仕様が曖昧で判断できない?
- [ ] 技術選定が必要?
- [ ] 設計の大きな変更が必要そう?
- [ ] 3回以上同じ問題で失敗した?
- [ ] パフォーマンス・セキュリティ上の懸念がある?

### 前提条件
- [ ] 問題を具体的に言語化できているか?
- [ ] 「なぜ?」を3回以上繰り返したか?
- [ ] 少なくとも2つ以上の解決案を試したか?
- [ ] 公式ドキュメントを確認したか?
- [ ] エラーメッセージを正確に記録したか?
- [ ] failure_logに失敗を記録したか?

### 禁止事項の確認
- [ ] 「何が分からないか分からない」状態で相談しようとしていないか?
- [ ] 何も試さずに相談しようとしていないか?
- [ ] 公式ドキュメントを確認せずに相談しようとしていないか?

---

## 🚨 鉄則

**具体的に言語化してから相談。「AとBで迷っている」まで絞り込む。**

---

## 役割分担

| ClaudeCode(ここ) | スマホ・PCクライアント |
|------------------|----------------------|
| 実際のコーディング | 問題の整理・分析 |
| ファイル操作 | 解決方針の決定 |
| テスト実行 | アーキテクチャ設計 |
| デバッグ作業 | トラブルシューティング方向性 |
| 動作確認 | |

---

## 相談すべきタイミング

- 仕様が曖昧で判断できない(自分で掘り下げても不明)
- 技術選定が必要(複数案を比較検討した上で)
- パフォーマンス・セキュリティ上の懸念(具体的な数値・リスクあり)
- 設計の大きな変更が必要そう(影響範囲を整理済み)
- 予想外の問題に遭遇(根本原因の仮説あり)
- 3回以上同じ問題で失敗した

---

## 相談テンプレート(詳細版)

```markdown
【相談: {相談内容の一行サマリ}】

## 1️⃣ 何が起きているか(事実)
- 現在のタスク: ...
- 進捗状況: ...
- 現在のブランチ: ...
- 発生している現象: ...

## 2️⃣ なぜそれが問題なのか
- 何を期待していたか: ...
- 実際には何が起きたか: ...
- このままでは何が困るか: ...

## 3️⃣ なぜその問題が発生したのか(原因の掘り下げ)
- 直接の原因: ...
- その原因が生じた理由: ...
- さらにその背景: ...
(「なぜ?」を3-5回繰り返して根本原因を探る)

## 4️⃣ 何を試したか
1. 試したこと: ...
   - 結果: ...
   - なぜうまくいかなかったか: ...

2. 試したこと: ...
   - 結果: ...
   - なぜうまくいかなかったか: ...

## 5️⃣ 判断が必要な点(具体的に)
- 技術選定: AとBのどちらを使うべきか?
- 設計方針: XとYのどちらのアプローチが適切か?
- 仕様解釈: この要件は○○という理解で合っているか?

(「何が分からないか分からない」ではなく、「AとBで迷っている」まで具体化する)

## 6️⃣ 制約条件
- パフォーマンス要件: ...
- 互換性: ...
- セキュリティ: ...
- その他制約: ...
```

---

## 相談例

### 良い相談

```markdown
【相談: JWTの保存場所をlocalStorageにするかhttpOnly Cookieにするか】

## 1️⃣ 何が起きているか(事実)
- 現在のタスク: 認証機能の実装
- 進捗状況: ログインAPI完成、トークン保存方法を検討中
- 現在のブランチ: feat/authentication
- 発生している現象: 設計判断が必要

## 2️⃣ なぜそれが問題なのか
- 何を期待していたか: セキュアかつ使いやすい認証
- 実際には何が起きたか: 両方式にトレードオフがある
- このままでは何が困るか: 後から変更するとコスト大

## 3️⃣ なぜその問題が発生したのか
- 直接の原因: セキュリティ要件と利便性のバランス
- その原因が生じた理由: XSS対策とCSRF対策の両立が難しい

## 4️⃣ 何を試したか
1. 試したこと: 公式ドキュメント調査
   - 結果: 両方式の説明はあるが推奨は明記なし
2. 試したこと: OWASP資料確認
   - 結果: httpOnly Cookie推奨だがSPA向けの注意点あり

## 5️⃣ 判断が必要な点
- localStorage: XSS脆弱性リスクあり、実装は簡単
- httpOnly Cookie: CSRF対策が追加で必要、実装複雑

## 6️⃣ 制約条件
- SPAアプリケーション
- 外部API連携あり(CORS考慮必要)
```

### 悪い相談

```markdown
【相談: 認証がうまくいかない】

なんかエラーが出ます。どうすればいいですか?
```

---

## 🚫 禁止事項まとめ

- 「何が分からないか分からない」状態で相談
- 何も試さずに相談
- 公式ドキュメントを確認せずに相談
- 漠然とした質問(「どうすればいい?」)
- エラーメッセージを記録せずに相談
