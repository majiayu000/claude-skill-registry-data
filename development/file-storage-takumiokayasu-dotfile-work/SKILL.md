---
name: file-storage
description: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€S3ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œã‚’æ‰±ã†éš›ã«ä½¿ç”¨ã€‚
---

# File & Storage

## ğŸ“‹ å®Ÿè¡Œå‰ãƒã‚§ãƒƒã‚¯(å¿…é ˆ)

### ã“ã®ã‚¹ã‚­ãƒ«ã‚’ä½¿ã†ã¹ãã‹?
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹?
- [ ] S3é€£æºã‚’è¡Œã†?
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹?
- [ ] ç½²åä»˜ãURLã‚’ç”Ÿæˆã™ã‚‹?

### å‰ææ¡ä»¶
- [ ] è¨±å¯ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’å®šç¾©ã—ãŸã‹?
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºä¸Šé™ã‚’æ±ºå®šã—ãŸã‹?
- [ ] ä¿å­˜å…ˆã‚’æ±ºå®šã—ãŸã‹?(ãƒ­ãƒ¼ã‚«ãƒ«/S3ç­‰)

### ç¦æ­¢äº‹é …ã®ç¢ºèª
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãã®ã¾ã¾ä½¿ãŠã†ã¨ã—ã¦ã„ãªã„ã‹?
- [ ] æ‹¡å¼µå­ã ã‘ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’åˆ¤æ–­ã—ã‚ˆã†ã¨ã—ã¦ã„ãªã„ã‹?
- [ ] ã‚µã‚¤ã‚ºåˆ¶é™ãªã—ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¨±å¯ã—ã‚ˆã†ã¨ã—ã¦ã„ãªã„ã‹?
- [ ] æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ã—ã‚ˆã†ã¨ã—ã¦ã„ãªã„ã‹?

---

## ãƒˆãƒªã‚¬ãƒ¼

- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Ÿè£…æ™‚
- S3é€£æºæ™‚
- ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å‡¦ç†æ™‚
- ç½²åä»˜ãURLç”Ÿæˆæ™‚

---

## ğŸš¨ é‰„å‰‡

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯ä¿¡ç”¨ã—ãªã„ã€‚æ¤œè¨¼å¿…é ˆã€‚**

---

## ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼

```typescript
// âš ï¸ å¿…é ˆãƒã‚§ãƒƒã‚¯
const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];
const MAX_SIZE = 5 * 1024 * 1024; // 5MB

function validateUpload(file: File) {
  // MIMEã‚¿ã‚¤ãƒ—(âš ï¸ æ‹¡å¼µå­ã ã‘ã§åˆ¤æ–­ã—ãªã„)
  if (!ALLOWED_TYPES.includes(file.mimetype)) {
    throw new Error('Invalid file type');
  }
  
  // ã‚µã‚¤ã‚º
  if (file.size > MAX_SIZE) {
    throw new Error('File too large');
  }
  
  // ãƒ•ã‚¡ã‚¤ãƒ«åã‚µãƒ‹ã‚¿ã‚¤ã‚º
  const safeName = sanitizeFilename(file.originalname);
}
```

---

## S3ç½²åä»˜ãURL

```typescript
import { getSignedUrl } from '@aws-sdk/s3-request-presigner';

const url = await getSignedUrl(s3Client, new GetObjectCommand({
  Bucket: 'my-bucket',
  Key: 'file.pdf'
}), { expiresIn: 3600 }); // 1æ™‚é–“
```

---

## ğŸš« ç¦æ­¢äº‹é …ã¾ã¨ã‚

- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã®ãã®ã¾ã¾ä½¿ç”¨
- æ‹¡å¼µå­ã ã‘ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¤æ–­
- ã‚µã‚¤ã‚ºåˆ¶é™ãªã—ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯å…¬é–‹
