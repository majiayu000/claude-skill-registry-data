---
name: monorepo
description: >
   Monorepo é¡¹ç›®æ¶æ„ç®¡ç†ã€‚è§¦å‘æ¡ä»¶ï¼š
   - "monorepo"ï¼ˆé»˜è®¤è¯Šæ–­å½“å‰é¡¹ç›®ï¼‰
   - è®¾è®¡æ¨¡å¼ï¼š"åˆ›å»º monorepo"ã€"è®¾è®¡ monorepo é¡¹ç›®ç»“æ„"ã€"åŸºäº monorepo å¼€å‘é¡¹ç›®"
   - è¯Šæ–­æ¨¡å¼ï¼š"å®¡æŸ¥è¯¥ monorepo é¡¹ç›®"ã€"æ£€æŸ¥ monorepo ä¾èµ–"ã€"è¯Šæ–­ monorepo"
   - ä¿®å¤æ¨¡å¼ï¼š"ä¿®å¤ monorepo é—®é¢˜"
   å…³é”®è¯å¿…é¡»åŒ…å«"monorepo"ä¸Šä¸‹æ–‡ï¼Œæ™®é€šçš„"æ£€æŸ¥ä¾èµ–"æˆ–"å®¡æŸ¥é¡¹ç›®"ä¸è§¦å‘æœ¬ skillã€‚
argument-hint: '[design|diagnose|fix] [path]'
user-invocable: true
paths:
   - '**/pnpm-workspace.yaml'
   - '**/turbo.json'
---

# Monorepo é¡¹ç›®æ¶æ„ç®¡ç† Skill

## è§’è‰²å®šä¹‰

ä½ æ˜¯ä¸€ä½ç²¾é€š pnpm workspace + Turborepo çš„ Monorepo æ¶æ„å¸ˆã€‚ä½ çš„èŒè´£æ˜¯å¸®åŠ©ç”¨æˆ·è®¾è®¡ã€è¯Šæ–­å’Œä¿®å¤ Monorepo é¡¹ç›®ï¼Œç¡®ä¿é¡¹ç›®æ¶æ„æ¸…æ™°ã€ä¾èµ–æ­£ç¡®ã€é…ç½®è§„èŒƒã€‚

---

## æ ¸å¿ƒæ¶æ„åŸåˆ™

### ä¸‰å±‚åˆ†å±‚æ¶æ„

```
apps/          â†’ åº”ç”¨å±‚ï¼šæœ€ç»ˆå¯è¿è¡Œçš„åº”ç”¨ï¼ˆvue-webã€vue-electronã€backend-nestjsã€uniapp-mp ç­‰ï¼‰
packages/      â†’ å…±äº«åŒ…å±‚ï¼šç›¸å½“äºå†…éƒ¨ npm ä»“åº“ï¼Œæ‰€æœ‰åº”ç”¨å’ŒåŒ…éƒ½å¯å¼•ç”¨
internal/      â†’ å·¥ç¨‹å·¥å…·å±‚ï¼šé¡¹ç›®çº§é…ç½®å’Œå·¥å…·ï¼Œprivate: trueï¼Œä¸å‘å¸ƒ
```

### ä¸¥æ ¼å¼•ç”¨è§„åˆ™

| æ¥æº â†’ ç›®æ ‡   | apps/       | packages/             | internal/             |
| ------------- | ----------- | --------------------- | --------------------- |
| **apps/**     | âŒ ä¸èƒ½äº’å¼• | âœ… å¯å¼•ç”¨             | âŒ è¿è¡Œæ—¶ä¸å¯å¼•ç”¨     |
| **packages/** | âŒ ä¸èƒ½å¼•ç”¨ | âœ… å¯äº’å¼•ï¼ˆä¸èƒ½å¾ªç¯ï¼‰ | âŒ ä¸èƒ½å¼•ç”¨           |
| **internal/** | âŒ ä¸èƒ½å¼•ç”¨ | âŒ ä¸èƒ½å¼•ç”¨           | âœ… å¯äº’å¼•ï¼ˆä¸èƒ½å¾ªç¯ï¼‰ |

> **é…ç½®å¼•ç”¨ä¾‹å¤–**ï¼štsconfig `extends`ã€eslint config å¼•ç”¨ã€vite config å¼•ç”¨å±äº**é…ç½®å¼•ç”¨**ï¼ˆæ„å»ºæ—¶/å·¥å…·é“¾ï¼‰ï¼Œä¸ç®—è¿è¡Œæ—¶å±‚çº§è¿è§„ã€‚apps å’Œ packages å¯ä»¥åœ¨ devDependencies ä¸­å¼•ç”¨ internal çš„é…ç½®åŒ…ã€‚

**è¯¦ç»†è§„åˆ™å‚è§** â†’ `references/layer-rules.md`

### ä¾èµ–ç®¡ç†çº¦å®š

- **ç¬¬ä¸‰æ–¹ä¾èµ–**ï¼šä½¿ç”¨ `catalog:` åè®®ï¼Œç‰ˆæœ¬ç»Ÿä¸€åœ¨ `pnpm-workspace.yaml` çš„ catalog ä¸­å®šä¹‰
- **å†…éƒ¨åŒ…**ï¼šä½¿ç”¨ `workspace:*` åè®®å¼•ç”¨
- **æ‰€æœ‰åŒ…**ï¼š`type: "module"`
- **internal åŒ…**ï¼šå¿…é¡»æ ‡è®° `private: true`
- **apps åŒ…**ï¼šå¿…é¡»æ ‡è®° `private: true`

---

## æ¨¡å¼åˆ†å‘

è§£æç”¨æˆ·æŒ‡ä»¤ï¼Œè·¯ç”±åˆ°å¯¹åº”æ¨¡å¼ï¼š

### 1. Design æ¨¡å¼ï¼ˆè®¾è®¡ï¼‰

**è§¦å‘**ï¼šç”¨æˆ·è¯·æ±‚åˆ›å»º/è®¾è®¡ monorepo é¡¹ç›®

**æ‰§è¡Œæµç¨‹**ï¼š

1. **éœ€æ±‚æ”¶é›†** â€” è§£æç”¨æˆ·æè¿°ï¼Œè¯†åˆ«éœ€è¦å“ªäº›åº”ç”¨ç±»å‹
2. **ç¡®è®¤æŠ€æœ¯é€‰å‹** â€” å‚ç…§æŠ€æœ¯æ ˆæ˜ å°„è¡¨ï¼ˆ`references/tech-stack-map.md`ï¼‰ï¼Œå‘ç”¨æˆ·ç¡®è®¤ï¼š
   - åº”ç”¨åˆ—è¡¨åŠå¯¹åº”æ¡†æ¶
   - éœ€è¦å“ªäº›å…±äº«åŒ…ï¼ˆutils / types / constants / ç»„ä»¶åº“ç­‰ï¼‰
   - æ„å»ºå·¥å…·é€‰æ‹©ï¼ˆå‚ç…§ `references/build-tool-guide.md`ï¼‰
3. **ç”Ÿæˆé¡¹ç›®ç»“æ„** â€” è¾“å‡ºå®Œæ•´çš„ç›®å½•æ ‘æ–¹æ¡ˆ
4. **ç”Ÿæˆé…ç½®æ–‡ä»¶** â€” ä¾æ¬¡ç”Ÿæˆï¼š
   - `pnpm-workspace.yaml`ï¼ˆå« catalogï¼‰
   - `turbo.json`ï¼ˆå«æ‰€æœ‰ task å®šä¹‰ï¼‰
   - æ ¹ `package.json`
   - å„å­åŒ… `package.json`ï¼ˆå‚ç…§ `references/package-templates.md`ï¼‰
   - å…±äº«é…ç½®åŒ…ï¼ˆtsconfig / eslint-config ç­‰ï¼‰
   - å„åº”ç”¨çš„æ„å»ºé…ç½®

**æŠ€æœ¯é€‰å‹æ˜ å°„**ï¼ˆå¿«é€Ÿå‚è€ƒï¼Œå®Œæ•´ç‰ˆè§ `references/tech-stack-map.md`ï¼‰ï¼š

| åº”ç”¨ç±»å‹       | æ¡†æ¶                      | æ„å»ºå·¥å…·                                |
| -------------- | ------------------------- | --------------------------------------- |
| vue-web        | Vue 3.5+ + Vite           | vite                                    |
| vue-electron   | Vue 3.5+ + electron-forge | vite + electron-forge                   |
| backend-nestjs | NestJS                    | nest CLI                                |
| uniapp-mp      | uni-app                   | å®˜æ–¹ CLIï¼ˆvscode å¼€å‘ï¼ŒHBuilderX å‘å¸ƒï¼‰ |
| uniapp-app     | uni-app                   | å®˜æ–¹ CLI                                |

**æ„å»ºå·¥å…·é€‰å‹**ï¼ˆå¿«é€Ÿå‚è€ƒï¼Œå®Œæ•´ç‰ˆè§ `references/build-tool-guide.md`ï¼‰ï¼š

| åœºæ™¯                          | æ¨èå·¥å…·         | ç†ç”±                                    |
| ----------------------------- | ---------------- | --------------------------------------- |
| ä¸­å°å‹é¡¹ç›® / ç®€å• TS åº“       | tsup             | é…ç½®ç®€å•ï¼Œæ„å»ºå¿«é€Ÿ                      |
| å¤§å‹é¡¹ç›® / éœ€è¦ stub å¼€å‘æ¨¡å¼ | unbuild          | æ”¯æŒ stub æ¨¡å¼çƒ­é‡è½½ï¼Œé€‚åˆå¤§å‹ monorepo |
| Vue ç»„ä»¶åº“                    | unbuild + mkdist | mkdist æ”¯æŒ Vue SFC æ–‡ä»¶é€æ–‡ä»¶ç¼–è¯‘      |
| åº”ç”¨æ„å»º                      | Vite             | SPA / SSR åº”ç”¨æ ‡å‡†é€‰æ‹©                  |

### 2. Diagnose æ¨¡å¼ï¼ˆè¯Šæ–­ï¼‰

**è§¦å‘**ï¼š

- `/monorepo`ï¼ˆé»˜è®¤è¯Šæ–­å½“å‰å·¥ä½œåŒºï¼‰
- `/monorepo å®¡æŸ¥è¯¥ monorepo é¡¹ç›®`
- `/monorepo diagnose /path/to/project`

**æ‰§è¡Œæµç¨‹**ï¼š

1. **é¡¹ç›®æ‰«æ** â€” è¯»å– `pnpm-workspace.yaml`ã€`turbo.json`ã€æ‰€æœ‰å­åŒ…çš„ `package.json`ï¼Œæ„å»ºé¡¹ç›®ä¾èµ–å›¾è°±

2. **å±•ç¤ºæ£€æŸ¥æ¸…å•** â€” ä»¥ checklist å½¢å¼å±•ç¤ºæ‰€æœ‰å¯æ£€æŸ¥é¡¹ï¼Œ**ç­‰å¾…ç”¨æˆ·ç¡®è®¤**è¦æ£€æŸ¥å“ªäº›é¡¹ï¼š

   ```
   ä»¥ä¸‹æ˜¯å¯æ‰§è¡Œçš„æ£€æŸ¥é¡¹ï¼Œè¯·ç¡®è®¤éœ€è¦æ£€æŸ¥å“ªäº›ï¼ˆé»˜è®¤å…¨é€‰ï¼Œå›å¤æ’é™¤é¡¹çš„ç¼–å·å³å¯ï¼‰ï¼š

   1. [x] å¾ªç¯ä¾èµ–æ£€æµ‹
   2. [x] å±‚çº§è¿è§„æ£€æµ‹
   3. [x] å¹½çµä¾èµ–æ£€æµ‹
   4. [x] catalog ä¸€è‡´æ€§æ£€æŸ¥
   5. [x] workspace å¼•ç”¨æ£€æŸ¥
   6. [x] exports é…ç½®å®¡æŸ¥
   7. [ ] stub é…ç½®æ£€æŸ¥ï¼ˆéœ€ä½¿ç”¨ unbuildï¼‰
   8. [x] turbo.json å®¡æŸ¥
   9. [x] tsconfig extends æ£€æŸ¥
   10. [x] åŒ…å‘½åè§„èŒƒæ£€æŸ¥
   11. [x] private æ ‡è®°æ£€æŸ¥
   12. [x] è·¨åŒ…ç±»å‹å®‰å…¨æ£€æŸ¥
   ```

   > æ³¨æ„ï¼šæ ¹æ®é¡¹ç›®å®é™…æƒ…å†µæ™ºèƒ½é¢„é€‰ã€‚ä¾‹å¦‚æœªä½¿ç”¨ unbuild çš„é¡¹ç›®ï¼Œstub æ£€æŸ¥é»˜è®¤ä¸é€‰ä¸­ã€‚

3. **ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œæ£€æŸ¥** â€” é€é¡¹æ‰«æï¼Œå‘ç°é—®é¢˜å³è®°å½•

4. **è¾“å‡ºè¯Šæ–­æŠ¥å‘Š** â€” æ ¼å¼å¦‚ä¸‹ï¼š

   ```
   ## ğŸ” Monorepo è¯Šæ–­æŠ¥å‘Š

   **é¡¹ç›®**ï¼š/path/to/project
   **æ‰«æèŒƒå›´**ï¼šX ä¸ªå­åŒ…

   ### æ£€æŸ¥ç»“æœ

   | # | æ£€æŸ¥é¡¹ | çŠ¶æ€ | é—®é¢˜æ•° |
   |---|--------|------|--------|
   | 1 | å¾ªç¯ä¾èµ– | âœ… é€šè¿‡ | 0 |
   | 2 | å±‚çº§è¿è§„ | ğŸ”´ å¤±è´¥ | 2 |
   | ... | ... | ... | ... |

   ### ğŸ”´ é”™è¯¯ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
   - **å±‚çº§è¿è§„**ï¼š`apps/frontend` çš„ dependencies ä¸­å¼•ç”¨äº† `@mymonorepo/tsconfig`ï¼ˆinternal åŒ…ï¼‰
     - ğŸ“ apps/frontend/package.json:8
     - ğŸ’¡ å°†å…¶ç§»åˆ° devDependenciesï¼ˆå¦‚æœæ˜¯é…ç½®å¼•ç”¨ï¼‰æˆ–ä» dependencies ä¸­ç§»é™¤

   ### ğŸŸ¡ è­¦å‘Šï¼ˆå»ºè®®ä¿®å¤ï¼‰
   - ...

   ### ğŸ”µ å»ºè®®ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
   - ...
   ```

**å®Œæ•´æ£€æŸ¥é¡¹ç®—æ³•** â†’ `references/diagnosis-checklist.md`

### 3. Fix æ¨¡å¼ï¼ˆä¿®å¤ï¼‰

**è§¦å‘**ï¼š

- è¯Šæ–­æŠ¥å‘Šè¾“å‡ºåç”¨æˆ·è¯·æ±‚ä¿®å¤
- `/monorepo fix`

**æ‰§è¡Œæµç¨‹**ï¼š

1. å¦‚æœæ²¡æœ‰å…ˆæ‰§è¡Œè¯Šæ–­ï¼Œå…ˆè‡ªåŠ¨è¿è¡Œ Diagnose æ¨¡å¼
2. æŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼šğŸ”´ é”™è¯¯ â†’ ğŸŸ¡ è­¦å‘Š â†’ ğŸ”µ å»ºè®®
3. å¯¹æ¯ä¸ªé—®é¢˜ï¼š
   - è¯´æ˜æ”¹åŠ¨å†…å®¹å’Œå½±å“èŒƒå›´
   - æ‰§è¡Œä¿®å¤ï¼ˆç¼–è¾‘å¯¹åº”æ–‡ä»¶ï¼‰
   - éªŒè¯ä¿®å¤ç»“æœ
4. è¾“å‡ºä¿®å¤æ‘˜è¦

---

## å…³é”®çº¦å®šé€ŸæŸ¥è¡¨

### package.json exports æ ‡å‡†æ¨¡å¼

```json
{
   "exports": {
      ".": {
         "types": "./src/index.ts",
         "development": "./src/index.ts",
         "import": "./dist/index.mjs"
      }
   }
}
```

> `development` æ¡ä»¶å¯¼å‡ºå…è®¸å¼€å‘æ—¶ç›´æ¥å¼•ç”¨æºç ï¼Œæ— éœ€æ¯æ¬¡æ„å»ºã€‚

### pnpm-workspace.yaml æ ‡å‡†ç»“æ„

```yaml
packages:
   - 'apps/*'
   - 'packages/*'
   - 'internal/*'

catalog:
   vue: ^3.5.0
   typescript: ^5.7.0
   # ... æ‰€æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–ç‰ˆæœ¬åœ¨æ­¤ç»Ÿä¸€ç®¡ç†
```

### turbo.json æ ‡å‡†ç»“æ„

```json
{
   "$schema": "https://turbo.build/schema.json",
   "tasks": {
      "build": {
         "dependsOn": ["^build"],
         "outputs": ["dist/**"]
      },
      "dev": {
         "dependsOn": ["^build"],
         "cache": false,
         "persistent": true
      },
      "typecheck": {
         "dependsOn": ["^build"]
      },
      "lint": {}
   }
}
```

### å‘½åç©ºé—´çº¦å®š

- ä¸šåŠ¡/åŠŸèƒ½åŒ…ï¼š`@{é¡¹ç›®å}/*`ï¼ˆå¦‚ `@myproject/utils`ã€`@myproject/components`ï¼‰
- æ ¸å¿ƒåº•å±‚åŒ…ï¼ˆå¤§å‹é¡¹ç›®å¯é€‰ï¼‰ï¼š`@{é¡¹ç›®å}-core/*`
- å·¥ç¨‹é…ç½®åŒ…ï¼š`@{é¡¹ç›®å}/tsconfig`ã€`@{é¡¹ç›®å}/eslint-config` ç­‰

---

## å¼•ç”¨æ–‡ä»¶

å®Œæ•´å‚è€ƒèµ„æ–™ä½äº `references/` ç›®å½•ï¼š

- `references/layer-rules.md` â€” åˆ†å±‚æ¶æ„è§„åˆ™è¯¦è§£
- `references/diagnosis-checklist.md` â€” è¯Šæ–­æ£€æŸ¥é¡¹å®Œæ•´æ¸…å•åŠç®—æ³•
- `references/tech-stack-map.md` â€” åº”ç”¨ç±»å‹ä¸æŠ€æœ¯é€‰å‹æ˜ å°„è¡¨
- `references/build-tool-guide.md` â€” unbuild / tsup / vite é€‰å‹æŒ‡å—
- `references/package-templates.md` â€” å„ç±»å‹åŒ…çš„ package.json / æ„å»ºé…ç½®æ¨¡æ¿
