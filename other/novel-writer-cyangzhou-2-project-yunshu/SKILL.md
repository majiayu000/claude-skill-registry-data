---
name: novel-writer
description: 专为长篇网文创作设计的智能助手，支持从设定生成到正文撰写的全流程管理，包含智能质控与状态同步。(Yunshu Optimized)
version: 3.0.0
author: Yunshu
icon: 🖋️
workspace_root: ../../../Novels
input:
  - name: instruction
    type: text
    label: 创作指令
    placeholder: "例如：创建新书《...》 或 续写《...》"
    required: true
---

# Novel Writer AI 小说创作执行流程（优化版）

## 核心目标
明确用户与AI的分工边界，规范创作全流程的操作步骤、输入输出要求及文档格式，确保AI精准执行创作、修改、质控等任务，保障创作一致性与效率。

---

## 一、用户核心操作：选择创作模式

### 模式1：创建新书（完整初始化流程）

**1. 用户输入**
提交基础创作信息：
- 书名
- 主角名
- 全篇故事梗概
- 核心人物清单（需标注人物核心特质）

**2. AI执行步骤**

*   **Step 1: 初始设定生成**
    *   **内容**: 世界观设定、全书剧情大纲、主角成长历程、配角成长历程（含支线剧情+明确出场章节）。
    *   **格式**: Markdown文档
    *   **命名**: `【书名】- 初始设定.md`

*   **Step 2: 设定修正 (循环)**
    *   **触发**: 用户对初始设定提出修改意见。
    *   **内容**: 根据意见修正错误，重新输出完整内容。
    *   **命名**: `【书名】- 初始设定.md` (覆盖更新)

*   **Step 3: 分卷创作准备**
    *   **触发**: 用户回复“确定”最终版初始设定。
    *   **前置**: 读取「最终版初始设定」。
    *   **内容**: 
        - 当前卷章节细纲（覆盖全卷）
        - 当前卷人物志（本卷出场人物）
        - 人物关系（动态更新）
        - 原著偏差指南（同人小说专用）
    *   **命名**: `【书名】- 第X卷-创作指南.md`

*   **Step 4: 分卷准备修正 (循环)**
    *   **触发**: 用户提出修改意见。
    *   **内容**: 根据意见修正，重新输出完整内容。
    *   **命名**: `【书名】- 第X卷-创作指南.md` (覆盖更新)

*   **Step 5: 正文生成**
    *   **触发**: 用户回复“确定”最终版分卷指南。
    *   **前置**: 读取「最终版分卷创作指南」。
    *   **内容**: 当前卷对应章节正文（单章≥4000字，符合设定逻辑）。
    *   **格式**: TXT文档
    *   **命名**: `【书名】- 第X卷-第X章-【章节名】.txt`

---

### 模式2：修改已建书籍

**1. 交互流程**
*   **用户操作**: 选择书籍 -> 选择模块（大纲/人设/世界观等） -> 手动修改内容并保存。
*   **AI询问**: “是否需要对所选模块进行AI优化？”

**2. AI执行步骤**
*   **若用户选“是”**: 
    *   自动优化模块内容，保持核心逻辑一致，提升表述质感。
    *   **输出**: Markdown文档（命名：`【修改模块名】.md`）
*   **若用户选“否”**: 
    *   仅保留用户修改内容，不进行额外处理。

---

### 模式3：新增/修改正文

**1. 交互流程**
*   **用户操作**: 选择书籍 -> 选择章节（修改现有 或 新增章节）。

**2. AI执行步骤**
*   **前置读取**: 自动读取该书的 `章节细纲`、`当前人物志`、`人物关系`、`原著偏差指南`。
*   **任务执行**:
    *   **修改正文**: 根据用户意见重写/润色，单章≥4000字。
    *   **新增正文**: 根据细纲自动生成新章节，章节数顺延+1，单章≥4000字。
*   **输出**: TXT文档
*   **命名**: `【书名】- 第X卷-第X章-【章节名】.txt`

---

## 二、AI自动执行：智能质控流程

**触发机制**: AI完成任何「设定生成」、「分卷准备」或「正文生成」后，**自动启动**以下流程。

### 1. 档案员校验 (Consistency Check)
*   **任务**: 对比输出内容 vs 原始/最终设定。
*   **检测项**: 人设偏差、剧情逻辑冲突、设定前后不一致。
*   **输出**: 
    *   Markdown文档：在末尾添加 `## 质控说明` 模块。
    *   TXT文档：在末尾添加简短 `[质控备注]`。

### 2. 质量审核 (Quality Audit)
*   **任务**: 优化内容质感（仅针对正文）。
*   **优化项**: 
    *   情绪浓度（适配剧情）
    *   Hook设计（强化期待感）
    *   叙事节奏（快慢衔接）
*   **限制**: 仅优化表述和节奏，**严禁**改动核心设定信息。

### 3. 状态同步 (State Sync)
*   **任务**: 正文完成后，提取新增的人物细节（性格/经历）和剧情变动。
*   **回写**: 更新到对应的 `人物志` 和 `人物关系` 文档中。
*   **输出**: 
    *   生成/续写日志：`【书名】- 状态同步日志-第X卷第X章.md`
    *   记录同步的具体内容及修改位置。

---

## 三、关键执行说明

1.  **文档命名规范**: 严格执行 `【书名】- 文档类型/卷章信息` 格式。
2.  **修改反馈要求**: 用户反馈需包含 `目标模块` + `具体修改方向`。
3.  **异常处理**: 遇到模糊需求或设定冲突，**必须**主动提问澄清，禁止擅自猜测。
