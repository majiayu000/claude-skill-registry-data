---
name: eld-ground-evaluate
description: |
  PCE (Process-Context Engine) の出力評価スキル。生成物の品質とLaw（法則）との整合性を検証する。
  LDE（Law-Driven Engineering）との統合により、Law遵守チェックも実行。

  トリガー条件:
  - コード生成後（「このコードをレビューして」）
  - 設計完了後（「設計をチェックして」）
  - PRマージ前（「マージ前の確認をして」）
  - 「品質チェックして」
  - 「整合性を確認して」
  - 「Law遵守をチェックして」
---

# PCE Evaluate Skill

出力の検証（テスト、レビュー、整合性チェック）を行う。

## 評価観点

### 1. 目的整合性
- アクティブコンテキストのGoalを達成しているか
- 期待する成果物が生成されたか
- 完了条件を満たしているか

### 2. 制約遵守
- Constraintsに違反していないか
- セキュリティ要件を満たしているか
- 性能要件を満たしているか

### 3. パターン一貫性
- 既存コードのパターンに従っているか
- CLAUDE.mdの規約に準拠しているか
- ADRの決定事項と整合しているか

### 4. 品質基準
- テストカバレッジは十分か
- エラーハンドリングは適切か
- ドキュメントは必要十分か

### 5. Law遵守（LDE統合）

LDEプロジェクトでは以下も検証：

| Law Type | チェック内容 |
|----------|-------------|
| **Invariant** | 状態制約が維持されているか |
| **Pre** | 入力バリデーションが実装されているか |
| **Post** | 出力保証がアサーションされているか |
| **Policy** | ビジネスルールが正しく実装されているか |

#### Law遵守チェックリスト
- [ ] 関連するLaw Catalogを参照したか
- [ ] 新規/変更コードが既存Lawに違反していないか
- [ ] 新たにLaw化すべき制約を発見したか
- [ ] Grounding（テスト・観測）が設定されているか

## 評価チェックリスト

```markdown
## Evaluation: [成果物名]

### 目的整合性
- [ ] Goalを達成している
- [ ] 期待する形式で出力されている
- [ ] 完了条件を満たしている

### 制約遵守
- [ ] セキュリティ要件OK
- [ ] 性能要件OK
- [ ] 禁止事項に違反なし

### パターン一貫性
- [ ] 既存パターンに準拠
- [ ] コーディング規約に準拠
- [ ] ADR決定事項と整合

### 品質基準
- [ ] テストカバレッジ >= 80%
- [ ] エラーハンドリング適切
- [ ] 必要なコメント記述済み

### Law遵守（LDE）
- [ ] 関連Lawを参照済み
- [ ] Invariant違反なし
- [ ] Pre/Post条件が実装済み
- [ ] 新規Lawの接地完了

### 検出された問題
- [ ] [問題1]: [重要度] [対応策]
```

## 評価結果の活用

| 結果 | アクション |
|------|-----------|
| 全てOK | Context Delta として記録し完了 |
| 軽微な問題 | 修正後に再評価 |
| 重大な問題 | 根本原因を調査し設計から見直し |

## 使用例

```
User: さっき作った認証機能をチェックして

Claude:
## Evaluation: 認証機能 (src/auth/)

### 目的整合性
- [x] JWT認証実装済み
- [x] ログイン/ログアウト実装済み
- [ ] トークンリフレッシュ未実装

### 制約遵守
- [x] OWASP Top 10準拠
- [x] レスポンス < 200ms
- [x] httpOnly Cookie使用

### パターン一貫性
- [x] 既存のServiceパターンに準拠
- [x] エラーレスポンス形式統一

### 品質基準
- [x] テストカバレッジ 82%
- [ ] refresh token失敗時のエラーハンドリング不足

### 検出された問題
1. トークンリフレッシュ未実装: High - 次タスクで対応
2. エラーハンドリング不足: Medium - 修正推奨

→ 1件の重要な未完了タスクあり
```

---

## 品質優先原則（Superpowers統合）

### 核心原則

1. **Epistemic Humility**: 推測を事実として扱わない。`unknown`と言う勇気を持つ
2. **Evidence First**: 結論ではなく因果と証拠を中心にする
3. **Minimal Change**: 最小単位で変更し、即時検証する
4. **Grounded Laws**: Lawは検証可能・観測可能でなければならない
5. **Source of Truth**: 真実は常に現在のコード。要約はインデックス

### 「速さより質」の実践

- 要件の曖昧さによる手戻りを根本から排除
- テストなし実装を許さない
- 観測不能な変更を防ぐ

### 完了の定義

- [ ] Evidence Ladder目標レベル達成
- [ ] Issue Contractの物差し満足
- [ ] Law/Termが接地している（Grounding Map確認）
- [ ] Link Mapに孤立がない
- [ ] ロールバック可能な状態

### 停止条件

以下が発生したら即座に停止し、追加計測またはスコープ縮小：

- 予測と現実の継続的乖離（想定外テスト失敗3回以上）
- 観測不能な変更の増加（物差しで検証できない変更）
- ロールバック線の崩壊（戻せない変更の発生）
